<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>3D Holzkiste in Web-Anwendung</title>
    <style>
        body { margin: 0; }
        canvas { display: block; }
        .controls, .controls2 {
            position: absolute;
            top: 10px;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 5px;
            width: 25%;
            font-family: Arial, sans-serif;
            min-width: 385px;
        }

        .controls {
            left: 10px;
        }

        .controls2 {
            left: calc(10px + 25% + 30px);
            display: none;
        }

        .bold-text {
            font-weight: bold;
            font-size: 20px;
        }

        


        .control-group {
            margin-bottom: 10px;
        }
        label {
            display: block;
        }
        input[type="number"], input[type="range"] {
            width: 100%;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            font-family: Arial, sans-serif;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 2px;
            text-align: middle;
        }
        th {
            background-color: #f2f2f2;
        }
        td input {
            width: 100%;
            box-sizing: border-box;
            text-align: middle;
        }
        #co2::after {
            content: " kg";
        }
        #kgTara::after {
            content: " kg";
        }
        #volumengesamt::after {
            content: " m³";
        }
        #außenquadratmeter::after {
            content: " m²";
        }
        #bodenquadratmeter::after {
            content: " m²";
        }


    </style>

    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

</head>
<body>
    <div class="controls">
        <button id="customButton">öffnen</button>
            <input type="file" id="uploadButton" accept=".json" style="display: none;">
        <button id="saveButton">Speichern</button>
        <button id="exportButton">exportiere Kistenzettel</button>
        <button id="toggleCameraButton">Ansicht umschalten</button>
        <button id="startARButton">Start AR</button>
        <button class="open-kalkulation-button">Kalkulation</button>
        <button class="saveDataToDatabase">saveDataToDatabase</button>

        <hr>
      
        <div class="control-group">
            <label for="länge">Länge</label>
            <input type="range" id="länge" min="10" max="500" step="1" value="200">
        </div>
        <div class="control-group">
            <label for="breite">Breite</label>
            <input type="range" id="breite" min="10" max="300" step="1" value="120">
        </div>
        <div class="control-group">
            <label for="höhe">Höhe</label>
            <input type="range" id="höhe" min="10" max="300" step="1" value="150">
        </div>

        <div class="control-group" style="display: flex; justify-content: space-between;">
            <div style="flex: 1; margin-right: 10px;">
                <label for="nettogewicht">Nettogewicht (kg)</label>
                <input type="number" id="nettogewicht" value="300">
            </div>
            <div style="flex: 1; margin-right: 10px;">
                <label for="stapellast">Stapellast (kg)</label>
                <input type="number" id="stapellast" value="300">
            </div>
        </div>

        <div class="control-group">
            <table>
                <thead>
                    <tr>
                        <th>Komponente</th>
                        <th>Höhe</th>
                        <th>Stärke</th>
                        <th>Anzahl</th>
                        <th>Länge</th>
                        <th>dm³</th>
                        <th>S %</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>LK</td>
                        <td><input type="number" id="längskufenHöhe" value="12"></td>
                        <td><input type="number" id="längskufenBreite" value="8"></td>
                        <td><input type="number" id="anzahlLängskufen" min="2" max="10" value="2"></td>
                        <td id="längeLängskufen"></td>
                        <td id="volumenLängskufen"></td>
                    </tr>
                    <tr>
                        <td>QK</td>
                        <td><input type="number" id="querkufenHöhe" value="12"></td>
                        <td><input type="number" id="querkufenBreite" value="8"></td>
                        <td><input type="number" id="anzahlQuerkufen" min="2" max="10" value="2"></td>
                        <td id="längeQuerkufen"></td>
                        <td id="volumenQuerkufen"></td>
                    </tr>
                    <tr>
                        <td>Kopfhölzer</td>
                        <td><input type="number" id="kopfholzHöhe" value="12"></td>
                        <td><input type="number" id="kopfholzBreite" value="8"></td>
                        <td id="anzahlKopfholz"></td>
                        <td id="längeKopfholz"></td>
                        <td id="volumenKopfholz"></td>
                    </tr>
                    <tr>
                        <td>Bodenauflage</td>
                        <td><input type="number" id="bodenBrettDicke" value="4"></td>
                        <td><input type="number" id="bodenBrettBreite" value="18"></td>
                        <td id="anzahlBodenBretter"></td>
                        <td id="bodenBrettLänge"></td>
                        <td id="volumenBodenBretter"></td>
                    </tr>
                    <tr>
                        <td>SL vertikal</td>
                        <td><input type="number" id="SeitenleisteVertikalBreite" value="6"></td>
                        <td><input type="number" id="SeitenleisteVertikalStärke" value="3"></td>
                        <td><input type="number" id="anzahlSeitenLeistenVertikal" min="2" max="10" value="2"></td>
                        <td id="längeSeitenLeistenVertikal"></td>
                        <td id="volumenseitenLeisteVertikal"></td>
                    </tr>
                    <tr>
                        <td>SL horizontal</td>
                        <td><input type="number" id="SeitenleisteHorizontalBreite" value="6"></td>
                        <td><input type="number" id="SeitenleisteHorizontalStärke" value="3"></td>
                        <td><input type="number" id="anzahlSeitenLeistenHorizontal" min="2" max="10" value="2"></td>

                        <td id="längeSeitenLeistenHorizontal"></td>
                        <td id="volumenSeitenLeistenHorizontal"></td>
                    </tr>
                    <tr>
                        <td>KL vertikal</td>
                        <td><input type="number" id="KopfleisteVertikalBreite" value="6"></td>
                        <td><input type="number" id="KopfleisteVertikalStärke" value="3"></td>
                        <td><input type="number" id="anzahlKopfLeistenVertikal" min="2" max="10" value="2"></td>
                        <td id="längeKopfLeistenVertikal"></td>
                        <td id="volumenKopfleisteVertikal"></td>
                    </tr>
                    <tr>
                        <td>KL horizontal</td>
                        <td><input type="number" id="KopfleisteHorizontalBreite" value="6"></td>
                        <td><input type="number" id="KopfleisteHorizontalStärke" value="3"></td>
                        <td><input type="number" id="anzahlKopfLeistenHorizontal" min="2" max="10" value="2"></td>
                        <td id="längeKopfLeistenHorizontal"></td>
                        <td id="volumenKopfleisteHorizontal"></td>
                    </tr>                    
                    <tr>
                        <td>DL vertikal</td>
                        <td><input type="number" id="DeckelleisteVertikalBreite" value="6"></td>
                        <td><input type="number" id="DeckelleisteVertikalStärke" value="3"></td>
                        <td><input type="number" id="anzahlDeckelLeistenVertikal" min="2" max="10" value="2"></td>
                        <td id="längeDeckelLeistenVertikal"></td>
                        <td id="volumenDeckelLeisteVertikal"></td>
                    </tr>
                    <tr>
                        <td>DL horizontal</td>
                        <td><input type="number" id="DeckelleisteHorizontalBreite" value="6"></td>
                        <td><input type="number" id="DeckelleisteHorizontalStärke" value="3"></td>
                        <td><input type="number" id="anzahlDeckelLeistenHorizontal" min="2" max="10" value="2"></td>
                        <td id="längeDeckelLeistenHorizontal"></td>
                        <td id="volumendeckelLeisteHorizontal"></td>
                    </tr> 
                    <tr>
                        <td>Deckelhölzer</td>
                        <td><input type="number" id="DeckelholzHöhe" value="12"></td>
                        <td><input type="number" id="DeckelholzBreite" value="8"></td>
                        <td><input type="number" id="anzahlDeckelholz" min="0" max="10" value="2"></td>
                        <td id="längeDeckelholz"></td>
                        <td id="volumenDeckelholz"></td>
                        <td id="sicherheitDeckelholz"></td>
                    </tr>      
                    <tr>
                        <td>Steher</td>
                        <td><input type="number" id="SteherHöhe" value="12"></td>
                        <td><input type="number" id="SteherBreite" value="8"></td>
                        <td><input type="number" id="anzahlSteher" min="0" max="10" value="2"></td>
                        <td id="längeSteher"></td>
                        <td id="volumenSteher"></td>
                    </tr>                 

 
                </tbody>
            </table>
        </div>
        <div class="control-group">
            <table>
                <tbody>
                    <tr>
                        <td>Innenmaße L x B x H</td>
                        <td id="innenlänge"></td>
                        <td id="innenbreite"></td>
                        <td id="innenhöhe"></td>
                    </tr>
                    <tr>
                        <td>Außenmaße L x B x H</td>
                        <td id="außenlänge"></td>
                        <td id="außenbreite"></td>
                        <td id="außenhöhe"></td>
                    </tr>
                    <tr>
                        <td>AQM</td>
                        <td id="außenquadratmeter"></td>
                    </tr>
                    <tr>
                        <td>BQM</td>
                        <td id="bodenquadratmeter"></td>
                    </tr>
                    <tr>
                        <td>m³</td>
                        <td id="volumengesamt"></td>
                    </tr>
                    <tr>
                        <td>kg Tara</td>
                        <td id="kgTara"></td>
                    </tr>
                    <tr>
                        <td>CO2</td>
                        <td id="co2"></td>
                    </tr>

                </tbody>
            </table>
            <p id="author" style="font-style: italic; text-align: center;">by Marius Reißdörfer</p>
        </div>
    </div>
    <div class="controls2">
        <button class="close-button">X</button>
        <div class="control-group" style="display: flex; justify-content: space-between;">
            <div style="flex: 1; margin-right: 10px;">
                <label for="stdSatzPlattensäge">Stundensatz Plattensäge €/h</label>
                <input type="number" id="stdSatzPlattensäge" value="50">
            </div>
            <div style="flex: 1; margin-right: 10px;">
                <label for="stdSatzLeistenzuschnitt">Stundensatz Lesitenzuschnitt €/h</label>
                <input type="number" id="stdSatzLeistenzuschnitt" value="45">
            </div>
        </div>
        <div class="control-group" style="display: flex; justify-content: space-between;">
            <div style="flex: 1; margin-right: 10px;">
                <label for="stdSatzMitarbeiter">Stundensatz Mitarbeiter €/h</label>
                <input type="number" id="stdSatzMitarbeiter" value="40">
            </div>
        </div>


        <div class="control-group">
            <table>
                <thead>
                    <tr>
                        <th>Arbeitsschritt</th>
                        <th>Einheit</th>
                        <th>Zeit/Einheit s</th>
                        <th>Bearbeitungszeit min</th>
                        <th>Kosten</th>
                    </tr>
                </thead>
                <tbody>  
                    <tbody>  
                        <th>Zuschnitt</th>
                    </tbody>
                    <tr>
                        <td>Plattenzuschnitt (anz. Platten)</td>
                        <td id="anzahlPlatten"></td>
                        <td><input type="number" id="dauerPlattenzuschnittProPlatte" value="240"></td>
                        <td id="dauerPlattenzuschnitt"></td>
                        <td id="kostenPlattenzuschnitt"></td>
                    </tr>                 
                </tbody>
                <tbody>  
                    <tr>
                        <td>Leistenzuschnitt (anz. Leisten)</td>
                        <td id="anzahlleisten"></td>
                        <td><input type="number" id="dauerLeistenschnittProLeiste" value="60"></td>
                        <td id="dauerLeistenzuschnitt"></td>
                        <td id="kostenLeistenzuschnitt"></td>
                    </tr>                 
                </tbody>
                <tbody>  
                        <th>Bodenmontage</th>
                </tbody>
                <tbody>  
                    <tr>
                        <td>Bodenhölzer auflegen (anz. Knthölzer LK+QK+KKH)</td>
                        <td id="anzahlBodenhölzer"></td>
                        <td><input type="number" id="dauerBodenhölzerAuflegenProHolz" value="60"></td>
                        <td id="dauerBodenhölzerAuflegen"></td>
                        <td id="kostenBodenhölzerAuflegen"></td>
                    </tr>                 
                </tbody>
                <tbody>  
                    <tr>
                        <td>Bodenhölzer verbolzen (anz. verbindungen)</td>
                        <td id="anzahlBodenhölzerVerbindungen"></td>
                        <td><input type="number" id="dauerBodenhölzerVerbindungenVerbolzenProHolz" value="120"></td>
                        <td id="dauerBodenhölzerVerbindungenVerbolzen"></td>
                        <td id="kostenBodenhölzerVerbindungenVerbolzen"></td>
                    </tr>                 
                </tbody>
                <tbody>  
                    <tr>
                        <td>BodenBelag auflegen und Vernageln (anz. Bodenbretter)</td>
                        <td id="anzahlBodenBretterFürKalk"></td>
                        <td><input type="number" id="dauerBodenbretterAuflegenUndVernagelnProHolz" value="20"></td>
                        <td id="dauerBodenbretterAuflegenUndVernageln"></td>
                        <td id="kostenBodenbretterAuflegenUndVernageln"></td>
                    </tr>                 
                </tbody>

                <tbody>  
                    <th>Segmentmontage ...</th>
                </tbody>
                <tbody>  
                    <th>Fertigungseinzelkosten</th>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td id="Fertigungseinzelkosten"></td>
                </tbody>
                <tbody>  
                    <th>Fertigungsgemeinkosten</th>
                    <td></td>
                    <td><input type="number" id="zuschlagssatzFertigungsgemeinkosten" value="12"></td>
                    <td></td>
                    <td id="Fertigungsgemeinkosten"></td>
                </tbody>
                <tbody>  
                    <th>Fertigungskosten</th>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td id="Fertigungskosten" class="bold-text"></td>></td>
                </tbody>

                <tbody>  
                    <th>Materialeinzelkosten</th>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td id="marteialeinzelkosten"></td>
                </tbody>

                <tbody>  
                    <th>Materialgeminkosten</th>
                    <td></td>
                    <td><input type="number" id="zuschlagssatzMaterialgemeinkosten" value="12"></td>
                    <td></td>
                    <td id="Materialgeminkosten"></td>
                </tbody>

                <tbody>  
                    <th>Materialkosten</th>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td id="Materialkosten" class="bold-text"></td>></td>
                </tbody>

                <tbody>  
                    <th>Herstellkosten</th>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td id="herstellkosten" class="bold-text"></td>
                </tbody>


        
            </table>
        </div>
    </div>




    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.14/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@webxr-polyfill/webxr-polyfill.min.js"></script>

    <model-viewer id="arViewer" src="model.glb" ar ar-modes="scene-viewer webxr quick-look" environment-image="neutral" skybox-image="neutral" alt="A 3D model of a box" auto-rotate camera-controls style="display:none; width: 100%; height: 500px;"></model-viewer>


    
    <script>


        
        // Szene, Kamera und Renderer erstellen
        const szene = new THREE.Scene();
        const kameraPerspektiv = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 5000);
        const kameraOrthogonal = new THREE.OrthographicCamera(window.innerWidth / -2, window.innerWidth / 2, window.innerHeight / 2, window.innerHeight / -2, 0.1, 5000);
        let aktuelleKamera = kameraPerspektiv;

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // OrbitControls für die Steuerung (bestehender Code)
        const steuerung = new THREE.OrbitControls(aktuelleKamera, renderer.domElement);
        steuerung.enableDamping = true;
        steuerung.dampingFactor = 0.25;
        steuerung.screenSpacePanning = true;
        steuerung.maxPolarAngle = 4 / 3 * Math.PI / 2;

        // Licht hinzufügen (bestehender Code)
        const umgebungslicht = new THREE.AmbientLight(0xffffff, 0.6);
        szene.add(umgebungslicht);

        const richtungslicht = new THREE.DirectionalLight(0xffffff, 0.6);
        richtungslicht.position.set(10, 10, 10).normalize();
        szene.add(richtungslicht);

        let kistengruppe = new THREE.Group();
        szene.add(kistengruppe);

        function toggleCameraView() {
            if (aktuelleKamera === kameraPerspektiv) {
                // Speichere die aktuelle Blickrichtung der perspektivischen Kamera
                const blickRichtung = new THREE.Vector3();
                kameraPerspektiv.getWorldDirection(blickRichtung);

                // Wechsel zur orthogonalen Kamera und übernehme die Position der perspektivischen Kamera
                kameraOrthogonal.position.copy(kameraPerspektiv.position);
                aktuelleKamera = kameraOrthogonal;

                // Wähle die nächste orthogonale Ansicht basierend auf der Blickrichtung
                if (Math.abs(blickRichtung.x) > Math.abs(blickRichtung.y) && Math.abs(blickRichtung.x) > Math.abs(blickRichtung.z)) {
                    if (blickRichtung.x > 0) {
                        kameraOrthogonal.position.set(-500, 0, 0); // Rechte Seitenansicht
                    } else {
                        kameraOrthogonal.position.set(500, 0, 0); // Linke Seitenansicht
                    }
                } else if (Math.abs(blickRichtung.y) > Math.abs(blickRichtung.x) && Math.abs(blickRichtung.y) > Math.abs(blickRichtung.z)) {
                    if (blickRichtung.y > 0) {
                        kameraOrthogonal.position.set(0, -500, 0); // Draufsicht
                    } else {
                        kameraOrthogonal.position.set(0, 500, 0); // Ansicht von unten
                    }
                } else {
                    if (blickRichtung.z > 0) {
                        kameraOrthogonal.position.set(0, 0, -500); // Frontalansicht
                    } else {
                        kameraOrthogonal.position.set(0, 0, 500); // Rückansicht
                    }
                }

                // Kamera genau auf den Ursprung schauen lassen und keine Rotationen zulassen
                steuerung.target.set(0, 0, 0);
                kameraOrthogonal.lookAt(0, 0, 0);
            } else {
                // Wechsel zurück zur perspektivischen Kamera und übernehme die Position der orthogonalen Kamera
                kameraPerspektiv.position.copy(kameraOrthogonal.position);
                aktuelleKamera = kameraPerspektiv;

                // Blickrichtung zum Ursprung beibehalten
                kameraPerspektiv.lookAt(0, 0, 0);
            }

            // Update OrbitControls mit der neuen Kamera
            steuerung.object = aktuelleKamera;
            steuerung.update();
        }
        
        async function startAR() {
    if (navigator.xr) {
        try {
            const isARSupported = await navigator.xr.isSessionSupported('immersive-ar');
            if (isARSupported) {
                const session = await navigator.xr.requestSession('immersive-ar');
                const renderer = new THREE.WebGLRenderer({ alpha: true });
                renderer.xr.enabled = true;
                document.body.appendChild(renderer.domElement);

                const controller = renderer.xr.getController(0);
                controller.addEventListener('select', onSelect);
                szene.add(controller);

                function onSelect() {
                    const geometry = new THREE.BoxGeometry(0.1, 0.1, 0.1);
                    const material = new THREE.MeshBasicMaterial({ color: 0xff0000 });
                    const mesh = new THREE.Mesh(geometry, material);
                    mesh.position.set(0, 0, -0.5).applyMatrix4(controller.matrixWorld);
                    szene.add(mesh);
                }

                renderer.setAnimationLoop(function () {
                    renderer.render(szene, kameraPerspektiv);
                });

                renderer.xr.setSession(session);
            } else {
                alert('AR wird auf diesem Gerät nicht unterstützt.');
                useModelViewerFallback();
            }
        } catch (e) {
            console.error('Unable to start AR session:', e);
            useModelViewerFallback();
        }
    } else {
        alert('WebXR wird auf diesem Gerät oder Browser nicht unterstützt.');
        useModelViewerFallback();
    }
}

function useModelViewerFallback() {
    const arViewer = document.getElementById('arViewer');
    arViewer.style.display = 'block'; // Zeigt das Model-Viewer-Element an
}

document.getElementById('startARButton').addEventListener('click', startAR);






        function downloadJSON(data, filename) {
            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        function exportParameters() {
            const parameters = {
                länge: document.getElementById('länge').value,
                breite: document.getElementById('breite').value,
                höhe: document.getElementById('höhe').value,
                nettogewicht: document.getElementById('nettogewicht').value,
                stapellast: document.getElementById('stapellast').value,
                anzahlLängskufen: document.getElementById('anzahlLängskufen').value,
                anzahlQuerkufen: document.getElementById('anzahlQuerkufen').value,
                längskufenBreite: document.getElementById('längskufenBreite').value,
                längskufenHöhe: document.getElementById('längskufenHöhe').value,
                kopfholzBreite: document.getElementById('kopfholzBreite').value,
                kopfholzHöhe: document.getElementById('kopfholzHöhe').value,
                bodenBrettDicke: document.getElementById('bodenBrettDicke').value,
                bodenBrettBreite: document.getElementById('bodenBrettBreite').value,
                querkufenBreite: document.getElementById('querkufenBreite').value,
                querkufenHöhe: document.getElementById('querkufenHöhe').value,
                KopfleisteHorizontalStärke: document.getElementById('KopfleisteHorizontalStärke').value,
                KopfleisteHorizontalBreite: document.getElementById('KopfleisteHorizontalBreite').value,
                anzahlKopfLeistenHorizontal: document.getElementById('anzahlKopfLeistenHorizontal').value,
                KopfleisteVertikalStärke: document.getElementById('KopfleisteVertikalStärke').value,
                KopfleisteVertikalBreite: document.getElementById('KopfleisteVertikalBreite').value,
                anzahlKopfLeistenVertikal: document.getElementById('anzahlKopfLeistenVertikal').value,
                SeitenleisteHorizontalStärke: document.getElementById('SeitenleisteHorizontalStärke').value,
                SeitenleisteHorizontalBreite: document.getElementById('SeitenleisteHorizontalBreite').value,
                anzahlSeitenLeistenHorizontal: document.getElementById('anzahlSeitenLeistenHorizontal').value,
                SeitenleisteVertikalStärke: document.getElementById('SeitenleisteVertikalStärke').value,
                SeitenleisteVertikalBreite: document.getElementById('SeitenleisteVertikalBreite').value,
                anzahlSeitenLeistenVertikal: document.getElementById('anzahlSeitenLeistenVertikal').value,
                DeckelleisteHorizontalStärke: document.getElementById('DeckelleisteHorizontalStärke').value,
                DeckelleisteHorizontalBreite: document.getElementById('DeckelleisteHorizontalBreite').value,
                anzahlDeckelLeistenHorizontal: document.getElementById('anzahlDeckelLeistenHorizontal').value,
                DeckelleisteVertikalStärke: document.getElementById('DeckelleisteVertikalStärke').value,
                DeckelleisteVertikalBreite: document.getElementById('DeckelleisteVertikalBreite').value,
                anzahlDeckelLeistenVertikal: document.getElementById('anzahlDeckelLeistenVertikal').value,
                DeckelholzHöhe: document.getElementById('DeckelholzHöhe').value,
                DeckelholzBreite: document.getElementById('DeckelholzBreite').value,
                anzahlDeckelholz: document.getElementById('anzahlDeckelholz').value,
                SteherHöhe: document.getElementById('SteherHöhe').value,
                SteherBreite: document.getElementById('SteherBreite').value,
                anzahlSteher: document.getElementById('anzahlSteher').value
            };
            downloadJSON(parameters, 'kiste_parameters.json');
        }

        

        function uploadJSON(event) {
            const file = event.target.files[0];
            if (!file) {
                return;
            }
            const reader = new FileReader();
            reader.onload = function(e) {
                const contents = e.target.result;
                const parameters = JSON.parse(contents);
                restoreParameters(parameters);
            };
            reader.readAsText(file);
        }

        function restoreParameters(parameters) {
            // Werte laden und Felder aktualisieren
            document.getElementById('länge').value =parameters.länge;
            document.getElementById('breite').value =parameters.breite;
            document.getElementById('höhe').value =parameters.höhe;
            document.getElementById('nettogewicht').value =parameters.nettogewicht;
            document.getElementById('stapellast').value =parameters.stapellast;
            document.getElementById('anzahlLängskufen').value = parameters.anzahlLängskufen;
            document.getElementById('anzahlQuerkufen').value = parameters.anzahlQuerkufen;
            document.getElementById('längskufenBreite').value = parameters.längskufenBreite;
            document.getElementById('längskufenHöhe').value = parameters.längskufenHöhe;
            document.getElementById('kopfholzBreite').value = parameters.kopfholzBreite;
            document.getElementById('kopfholzHöhe').value = parameters.kopfholzHöhe;
            document.getElementById('bodenBrettDicke').value = parameters.bodenBrettDicke;
            document.getElementById('bodenBrettBreite').value = parameters.bodenBrettBreite;
            document.getElementById('querkufenBreite').value = parameters.querkufenBreite;
            document.getElementById('querkufenHöhe').value = parameters.querkufenHöhe;
            document.getElementById('KopfleisteHorizontalStärke').value = parameters.KopfleisteHorizontalStärke;
            document.getElementById('KopfleisteHorizontalBreite').value = parameters.KopfleisteHorizontalBreite;
            document.getElementById('anzahlKopfLeistenHorizontal').value = parameters.anzahlKopfLeistenHorizontal;
            document.getElementById('KopfleisteVertikalStärke').value = parameters.KopfleisteVertikalStärke;
            document.getElementById('KopfleisteVertikalBreite').value = parameters.KopfleisteVertikalBreite;
            document.getElementById('anzahlKopfLeistenVertikal').value = parameters.anzahlKopfLeistenVertikal;
            document.getElementById('SeitenleisteHorizontalStärke').value = parameters.SeitenleisteHorizontalStärke;
            document.getElementById('SeitenleisteHorizontalBreite').value = parameters.SeitenleisteHorizontalBreite;
            document.getElementById('anzahlSeitenLeistenHorizontal').value = parameters.anzahlSeitenLeistenHorizontal;
            document.getElementById('SeitenleisteVertikalStärke').value = parameters.SeitenleisteVertikalStärke;
            document.getElementById('SeitenleisteVertikalBreite').value = parameters.SeitenleisteVertikalBreite;
            document.getElementById('anzahlSeitenLeistenVertikal').value = parameters.anzahlSeitenLeistenVertikal;
            document.getElementById('DeckelleisteHorizontalStärke').value = parameters.DeckelleisteHorizontalStärke;
            document.getElementById('DeckelleisteHorizontalBreite').value = parameters.DeckelleisteHorizontalBreite;
            document.getElementById('anzahlDeckelLeistenHorizontal').value = parameters.anzahlDeckelLeistenHorizontal;
            document.getElementById('DeckelleisteVertikalStärke').value = parameters.DeckelleisteVertikalStärke;
            document.getElementById('DeckelleisteVertikalBreite').value = parameters.DeckelleisteVertikalBreite;
            document.getElementById('anzahlDeckelLeistenVertikal').value = parameters.anzahlDeckelLeistenVertikal;
            document.getElementById('DeckelholzHöhe').value = parameters.DeckelholzHöhe;
            document.getElementById('DeckelholzBreite').value = parameters.DeckelholzBreite;
            document.getElementById('anzahlDeckelholz').value = parameters.anzahlDeckelholz;
            document.getElementById('SteherHöhe').value = parameters.SteherHöhe;
            document.getElementById('SteherBreite').value = parameters.SteherBreite;
            document.getElementById('anzahlSteher').value = parameters.anzahlSteher;

            // Kiste aktualisieren, nachdem alle Werte gesetzt wurden
            aktualisiereKiste();
        }

        // Funktion zum Erstellen der Holzkiste
        function erstelleKiste() {
            // Material für die verschiedenen Komponenten
            const längskufenMaterial = new THREE.MeshStandardMaterial({ color: 0x8B4513 });
            const kopfholzMaterial = new THREE.MeshStandardMaterial({ color: 0xA0522D });
            const bodenBrettMaterial = new THREE.MeshStandardMaterial({ color: 0xCD853F });
            const querkufenMaterial = new THREE.MeshStandardMaterial({ color: 0xD2B48C });
            const sperrholzMaterial = new THREE.MeshStandardMaterial({ color: 0xDEB887 });
            const leistenKopfHorizontalMaterial = new THREE.MeshStandardMaterial({ color: 0x8B4513 });
            const leistenKopfVertikalMaterial = new THREE.MeshStandardMaterial({ color: 0xA0522D });
            const leistenSeiteHorizontalMaterial = new THREE.MeshStandardMaterial({ color: 0x8B4513 });
            const leistenSeiteVertikalMaterial = new THREE.MeshStandardMaterial({ color: 0xA0522D });
            const leistenDeckelHorizontalMaterial = new THREE.MeshStandardMaterial({ color: 0x8B4513 });
            const leistenDeckelVertikalMaterial = new THREE.MeshStandardMaterial({ color: 0xA0522D });
            const DeckelholzMaterial = new THREE.MeshStandardMaterial({ color: 0x8B4513 });
            const SteherMaterial = new THREE.MeshStandardMaterial({ color: 0xA0522D });

            // Linienmaterial für die sichtbaren Kanten
            const kantenMaterial = new THREE.LineBasicMaterial({ color: 0x000000 });

            // Hilfsfunktion zum Erstellen von Kanten
            function createEdges(mesh) {
                const edges = new THREE.EdgesGeometry(mesh.geometry);
                const line = new THREE.LineSegments(edges, kantenMaterial);
                line.position.copy(mesh.position);
                line.rotation.copy(mesh.rotation);
                line.scale.copy(mesh.scale);
                return line;
            }

            // Maße der Komponenten

            const sperrholzDicke = 1.2;

            const länge = parseFloat(document.getElementById('länge').value);
            const breite = parseFloat(document.getElementById('breite').value);
            const höhe = parseFloat(document.getElementById('höhe').value);
            const nettogewicht = parseInt(document.getElementById('nettogewicht').value); 
            const stapellast = parseInt(document.getElementById('stapellast').value);
            const anzahlLängskufen = parseInt(document.getElementById('anzahlLängskufen').value);
            const anzahlQuerkufen = parseInt(document.getElementById('anzahlQuerkufen').value);
            const längskufenBreite = parseFloat(document.getElementById('längskufenBreite').value);
            const längskufenHöhe = parseFloat(document.getElementById('längskufenHöhe').value);
            const kopfholzBreite = parseFloat(document.getElementById('kopfholzBreite').value);
            const kopfholzHöhe = parseFloat(document.getElementById('kopfholzHöhe').value);
            const bodenBrettDicke = parseFloat(document.getElementById('bodenBrettDicke').value);
            const bodenBrettBreite = parseFloat(document.getElementById('bodenBrettBreite').value);
            const querkufenBreite = parseFloat(document.getElementById('querkufenBreite').value);
            const querkufenHöhe = parseFloat(document.getElementById('querkufenHöhe').value);
            //const sperrholzDicke = parseFloat(document.getElementById('breite').value);
            const KopfleisteHorizontalStärke = parseFloat(document.getElementById('KopfleisteHorizontalStärke').value);
            const KopfleisteHorizontalBreite = parseFloat(document.getElementById('KopfleisteHorizontalBreite').value);
            const anzahlKopfLeistenHorizontal = parseFloat(document.getElementById('anzahlKopfLeistenHorizontal').value);
            const KopfleisteVertikalStärke = parseFloat(document.getElementById('KopfleisteVertikalStärke').value);
            const KopfleisteVertikalBreite = parseFloat(document.getElementById('KopfleisteVertikalBreite').value);
            const anzahlKopfLeistenVertikal = parseFloat(document.getElementById('anzahlKopfLeistenVertikal').value);
            const SeitenleisteHorizontalStärke = parseFloat(document.getElementById('SeitenleisteHorizontalStärke').value);
            const SeitenleisteHorizontalBreite = parseFloat(document.getElementById('SeitenleisteHorizontalBreite').value);
            const anzahlSeitenLeistenHorizontal = parseFloat(document.getElementById('anzahlSeitenLeistenHorizontal').value);
            const SeitenleisteVertikalStärke = parseFloat(document.getElementById('SeitenleisteVertikalStärke').value);
            const SeitenleisteVertikalBreite = parseFloat(document.getElementById('SeitenleisteVertikalBreite').value);
            const anzahlSeitenLeistenVertikal = parseFloat(document.getElementById('anzahlSeitenLeistenVertikal').value);
            const DeckelleisteHorizontalStärke = parseFloat(document.getElementById('DeckelleisteHorizontalStärke').value);
            const DeckelleisteHorizontalBreite = parseFloat(document.getElementById('DeckelleisteHorizontalBreite').value);
            const anzahlDeckelLeistenHorizontal = parseFloat(document.getElementById('anzahlDeckelLeistenHorizontal').value);            
            const DeckelleisteVertikalStärke = parseFloat(document.getElementById('DeckelleisteVertikalStärke').value);
            const DeckelleisteVertikalBreite = parseFloat(document.getElementById('DeckelleisteVertikalBreite').value);
            const anzahlDeckelLeistenVertikal = parseFloat(document.getElementById('anzahlDeckelLeistenVertikal').value);
            let DeckelholzHöhe = parseFloat(document.getElementById('DeckelholzHöhe').value);
            const DeckelholzBreite = parseFloat(document.getElementById('DeckelholzBreite').value);
            const anzahlDeckelholz = parseFloat(document.getElementById('anzahlDeckelholz').value);
            let SteherHöhe = parseFloat(document.getElementById('SteherHöhe').value);
            const SteherBreite = parseFloat(document.getElementById('SteherBreite').value);
            const anzahlSteher = parseFloat(document.getElementById('anzahlSteher').value);
            

            // Baugruppe für den Boden
            let bodenGruppe = new THREE.Group();

            // Setzt die höhe der Steher und der Deckelhölzer auf 0 wenn Anzahl = Null
            if(anzahlDeckelholz==0){
                DeckelholzHöhe=0;
            }
            if(anzahlSteher==0){
                SteherHöhe=0;
            }

            // Querkufen erstellen und zur Boden-Baugruppe hinzufügen
            const einrückmaßQuerkufe = 40;
            const längeQuerkufen = breite + 2 * SteherHöhe + 2* sperrholzDicke + SeitenleisteVertikalStärke*2;
            const querkufenAbstand = (länge- 2 * einrückmaßQuerkufe - querkufenBreite) / (anzahlQuerkufen - 1);
            const volumenQuerkufen = anzahlQuerkufen * querkufenBreite * querkufenHöhe * längeQuerkufen /1000;
            for (let i = 0; i < anzahlQuerkufen; i++) {
                const querkufenGeometrie = new THREE.BoxGeometry(querkufenBreite, querkufenHöhe, längeQuerkufen );
                const querkufe = new THREE.Mesh(querkufenGeometrie, querkufenMaterial);
                querkufe.position.set(-länge / 2 + einrückmaßQuerkufe + i * querkufenAbstand + querkufenBreite / 2, - bodenBrettDicke - längskufenHöhe - querkufenHöhe / 2, 0);
                bodenGruppe.add(querkufe);
                bodenGruppe.add(createEdges(querkufe)); // Kanten hinzufügen
            }

            // Längskufen erstellen und zur Boden-Baugruppe hinzufügen
            const längeLängskufen = länge+ KopfleisteHorizontalStärke* 2;
            const längskufenAbstand = (breite + 2 * SteherHöhe + 2 * SeitenleisteVertikalStärke - längskufenBreite) / (anzahlLängskufen - 1);
            const volumenLängskufen = anzahlLängskufen* längeLängskufen * längskufenHöhe * längskufenBreite /1000;
            for (let i = 0; i < anzahlLängskufen; i++) {
                const längskufenGeometrie = new THREE.BoxGeometry(längeLängskufen, längskufenHöhe, längskufenBreite);
                const längskufe = new THREE.Mesh(längskufenGeometrie, längskufenMaterial);
                längskufe.position.set(0, - bodenBrettDicke - längskufenHöhe / 2, -breite / 2 + längskufenBreite / 2 - SeitenleisteVertikalStärke - SteherHöhe + i * längskufenAbstand);
                bodenGruppe.add(längskufe);
                bodenGruppe.add(createEdges(längskufe)); // Kanten hinzufügen
            }

            // Kopfhölzer erstellen und zur Boden-Baugruppe hinzufügen
            const längeKopfholz = breite + SteherHöhe * 2;
            const anzahlKopfholz = 2;
            const volumenKopfholz = anzahlKopfholz *kopfholzBreite * kopfholzHöhe * längeKopfholz /1000;
            const kopfholzGeometrie = new THREE.BoxGeometry(kopfholzBreite, kopfholzHöhe, längeKopfholz);
            const vorderesKopfholz = new THREE.Mesh(kopfholzGeometrie, kopfholzMaterial);
            const hinteresKopfholz = new THREE.Mesh(kopfholzGeometrie, kopfholzMaterial);

            vorderesKopfholz.position.set(-länge / 2 + kopfholzBreite / 2, - bodenBrettDicke + kopfholzHöhe / 2, 0);
            hinteresKopfholz.position.set(länge / 2 - kopfholzBreite / 2, - bodenBrettDicke + kopfholzHöhe / 2, 0);



            bodenGruppe.add(vorderesKopfholz);
            bodenGruppe.add(hinteresKopfholz);
            bodenGruppe.add(createEdges(vorderesKopfholz)); // Kanten hinzufügen
            bodenGruppe.add(createEdges(hinteresKopfholz)); // Kanten hinzufügen

            // Bodenauflage erstellen und zur Boden-Baugruppe hinzufügen
            const bodenBrettLänge = breite + SteherHöhe * 2 + SeitenleisteVertikalStärke*2 ;
            const anzahlBodenBretter = Math.floor((länge - kopfholzBreite * 2) / bodenBrettBreite);
            const volumenBodenBretter = anzahlBodenBretter *bodenBrettBreite* bodenBrettDicke* bodenBrettLänge /1000;
            for (let i = 0; i < anzahlBodenBretter; i++) {
                const bodenBrettGeometrie = new THREE.BoxGeometry(bodenBrettBreite, bodenBrettDicke, bodenBrettLänge);
                const bodenBrett = new THREE.Mesh(bodenBrettGeometrie, bodenBrettMaterial);
                bodenBrett.position.set(-länge / 2 + kopfholzBreite + bodenBrettBreite / 2 + i * (länge - 2 * kopfholzBreite) / anzahlBodenBretter,- bodenBrettDicke / 2, 0);
                bodenGruppe.add(bodenBrett);
                bodenGruppe.add(createEdges(bodenBrett)); // Kanten hinzufügen
            }

            // Boden-Baugruppe zur Kistengruppe hinzufügen
            kistengruppe.add(bodenGruppe);

            // Baugruppe für die Kopfplatte
            let kopfGruppe = new THREE.Group();

            // Kopfplatte erstellen und zur Kopf-Baugruppe hinzufügen
            const längeKopfplatte = breite + SeitenleisteHorizontalStärke * 2 + SteherHöhe *2;
            const breiteKopfplatte = höhe + bodenBrettDicke + längskufenHöhe + DeckelleisteHorizontalStärke + DeckelholzHöhe;
            const volumenKopfplatte = 2 * sperrholzDicke * breiteKopfplatte * längeKopfplatte /1000;
            const kopfplatteGeometrie = new THREE.BoxGeometry(sperrholzDicke, breiteKopfplatte, längeKopfplatte);
            const kopfplatte = new THREE.Mesh(kopfplatteGeometrie, sperrholzMaterial);
            kopfplatte.position.set(KopfleisteHorizontalStärke+sperrholzDicke / 2, höhe / 2 + DeckelholzHöhe/2 - bodenBrettDicke/2 - längskufenHöhe/2 + DeckelleisteHorizontalStärke/2, 0);
            kopfGruppe.add(kopfplatte);
            kopfGruppe.add(createEdges(kopfplatte)); // Kanten hinzufügen

            // Kopfplatte Leisten horizontal erstellen und zur Kopf-Baugruppe hinzufügen
            const abstandKopfLeistenHorizontal = (höhe + DeckelholzHöhe + bodenBrettDicke - KopfleisteHorizontalBreite) / (anzahlKopfLeistenHorizontal - 1);
            const längeKopfLeistenHorizontal = breite + SteherHöhe * 2;
            const volumenKopfleisteHorizontal = 2 * anzahlKopfLeistenHorizontal *KopfleisteHorizontalStärke* KopfleisteHorizontalBreite* längeKopfLeistenHorizontal /1000;
            for (let i = 0; i < anzahlKopfLeistenHorizontal; i++) {
                const kopfLeisteHorizontalGeometrie = new THREE.BoxGeometry(KopfleisteHorizontalStärke, KopfleisteHorizontalBreite, längeKopfLeistenHorizontal);
                const kopfLeisteHorizontal = new THREE.Mesh(kopfLeisteHorizontalGeometrie, leistenKopfHorizontalMaterial);
                kopfLeisteHorizontal.position.set(KopfleisteHorizontalStärke / 2,  KopfleisteHorizontalBreite/2 - bodenBrettDicke + i * abstandKopfLeistenHorizontal, 0);
                kopfGruppe.add(kopfLeisteHorizontal);
                kopfGruppe.add(createEdges(kopfLeisteHorizontal)); // Kanten hinzufügen
            }

            // Kopfplatte Leisten vertikal erstellen und zur Kopf-Baugruppe hinzufügen
            const abstandKopfLeistenVertikal = (breite + SteherHöhe * 2 - KopfleisteVertikalBreite) / (anzahlKopfLeistenVertikal - 1);
            const längeKopfLeistenVertikal = höhe + DeckelholzHöhe - 2 * KopfleisteHorizontalBreite + bodenBrettDicke;
            const volumenKopfleisteVertikal = 2 * anzahlKopfLeistenVertikal * KopfleisteVertikalStärke * längeKopfLeistenVertikal * KopfleisteVertikalBreite /1000;
            for (let i = 0; i < anzahlKopfLeistenVertikal; i++) {
                const kopfLeisteVertikalGeometrie = new THREE.BoxGeometry(KopfleisteVertikalStärke, längeKopfLeistenVertikal, KopfleisteVertikalBreite);
                const kopfLeisteVertikal = new THREE.Mesh(kopfLeisteVertikalGeometrie, leistenKopfVertikalMaterial);
                kopfLeisteVertikal.position.set( KopfleisteHorizontalStärke / 2, höhe / 2 + DeckelholzHöhe/2 - bodenBrettDicke/2, -breite / 2 - SteherHöhe + KopfleisteVertikalBreite/2 + i * abstandKopfLeistenVertikal);
                kopfGruppe.add(kopfLeisteVertikal);
                kopfGruppe.add(createEdges(kopfLeisteVertikal)); // Kanten hinzufügen
            }

            // Kopf-Baugruppe zur Kistengruppe hinzufügen
            kopfGruppe.position.set(länge / 2 , 0, 0);
            kistengruppe.add(kopfGruppe);

            // Baugruppe für die Seitenplatte
            let seitenGruppe = new THREE.Group();

            // Seitenplatte erstellen und zur Seiten-Baugruppe hinzufügen
            const längeSeitenplatte = länge + 2 * KopfleisteVertikalStärke + 2* sperrholzDicke;
            const breiteSeitenplatte = höhe + DeckelholzHöhe + bodenBrettDicke + längskufenHöhe + DeckelleisteHorizontalStärke;
            const volumenSeitenplatte = 2 * sperrholzDicke * breiteSeitenplatte * längeSeitenplatte /1000;
            const seitenplatteGeometrie = new THREE.BoxGeometry(sperrholzDicke, breiteSeitenplatte, längeSeitenplatte);
            const seitenplatte = new THREE.Mesh(seitenplatteGeometrie, sperrholzMaterial);
            seitenplatte.position.set(sperrholzDicke/2 + SeitenleisteHorizontalStärke + SteherHöhe, höhe / 2 + DeckelholzHöhe/2 - bodenBrettDicke/2 - längskufenHöhe/2 + DeckelleisteHorizontalStärke/2 , 0);
            seitenGruppe.add(seitenplatte);
            seitenGruppe.add(createEdges(seitenplatte)); // Kanten hinzufügen

            // Seitenplatte Leisten horizontal erstellen und zur Seiten-Baugruppe hinzufügen
            const abstandSeitenLeistenHorizontal = (höhe-SeitenleisteHorizontalBreite) / (anzahlSeitenLeistenHorizontal - 1);
            const längeSeitenLeistenHorizontal = länge + 2 * KopfleisteHorizontalStärke;
            const volumenSeitenLeistenHorizontal = 2 * anzahlSeitenLeistenHorizontal * SeitenleisteHorizontalStärke * SeitenleisteHorizontalBreite * längeSeitenLeistenHorizontal /1000;
            for (let i = 0; i < anzahlSeitenLeistenHorizontal; i++) {
                const seitenLeisteHorizontalGeometrie = new THREE.BoxGeometry(SeitenleisteHorizontalStärke, SeitenleisteHorizontalBreite, längeSeitenLeistenHorizontal );
                const seitenLeisteHorizontal = new THREE.Mesh(seitenLeisteHorizontalGeometrie, leistenSeiteHorizontalMaterial);
                seitenLeisteHorizontal.position.set(SeitenleisteHorizontalStärke/2 + SteherHöhe, SeitenleisteHorizontalBreite/2 + i * abstandSeitenLeistenHorizontal, 0);
                seitenGruppe.add(seitenLeisteHorizontal);
                seitenGruppe.add(createEdges(seitenLeisteHorizontal)); // Kanten hinzufügen
            }
               


            // Seitenplatte Leisten vertikal erstellen und zur Seiten-Baugruppe hinzufügen
            const abstandSeitenLeistenVertikal = (länge + 2 * KopfleisteVertikalStärke - SeitenleisteVertikalBreite) / (anzahlSeitenLeistenVertikal - 1);
            const längeSeitenLeistenVertikal = höhe - 2 * SeitenleisteHorizontalBreite;
            const volumenseitenLeisteVertikal = 2 * anzahlSeitenLeistenVertikal * SeitenleisteVertikalStärke * längeSeitenLeistenVertikal * SeitenleisteVertikalBreite /1000;
            for (let i = 0; i < anzahlSeitenLeistenVertikal; i++) {
                const seitenLeisteVertikalGeometrie = new THREE.BoxGeometry(SeitenleisteVertikalStärke, längeSeitenLeistenVertikal, SeitenleisteVertikalBreite);
                const seitenLeisteVertikal = new THREE.Mesh(seitenLeisteVertikalGeometrie, leistenSeiteVertikalMaterial);
                seitenLeisteVertikal.position.set(SeitenleisteHorizontalStärke/2 + SteherHöhe, höhe/2, -länge / 2 - KopfleisteHorizontalStärke + SeitenleisteVertikalBreite/2 + i * abstandSeitenLeistenVertikal);
                seitenGruppe.add(seitenLeisteVertikal);
                seitenGruppe.add(createEdges(seitenLeisteVertikal)); // Kanten hinzufügen
            }

            // Steher erstellen und zur Seiten-Baugruppe hinzufügen
            const abstandSteher = (länge) / (anzahlSteher+1);
            const längeSteher = höhe;
            const volumenSteher = 2 * anzahlSteher * SteherHöhe * längeSteher * SteherBreite /1000;
            for (let i = 0; i < anzahlSteher; i++) {
                const SteherGeometrie = new THREE.BoxGeometry(SteherHöhe, längeSteher, SteherBreite);
                const seitenSteher = new THREE.Mesh(SteherGeometrie, leistenSeiteVertikalMaterial);
                seitenSteher.position.set(+SteherHöhe/2, höhe/2,-länge/2 + abstandSteher + i * abstandSteher);
                seitenGruppe.add(seitenSteher);
                seitenGruppe.add(createEdges(seitenSteher)); // Kanten hinzufügen
            }

            // Seiten-Baugruppe zur Kistengruppe hinzufügen
            seitenGruppe.position.set(0, 0, -breite/2);
            seitenGruppe.rotation.y = Math.PI / 2;
            kistengruppe.add(seitenGruppe);

            // Baugruppe für die Deckelplatte
            let deckelGruppe = new THREE.Group();

            // Deckelplatte erstellen und zur Deckel-Baugruppe hinzufügen
            const längeDeckelplatte = länge + 2 * KopfleisteVertikalStärke + 2* sperrholzDicke;
            const breiteDeckelplatte = breite + SteherHöhe * 2 + 2 * SeitenleisteHorizontalStärke+ 2 * sperrholzDicke;
            const volumenDeckel = längeDeckelplatte * sperrholzDicke * breiteDeckelplatte /1000;
            const deckelplatteGeometrie = new THREE.BoxGeometry(längeDeckelplatte, sperrholzDicke, breiteDeckelplatte);
            const deckelplatte = new THREE.Mesh(deckelplatteGeometrie, sperrholzMaterial);
            deckelplatte.position.set(0, DeckelleisteHorizontalStärke+ DeckelholzHöhe + sperrholzDicke / 2, 0);
            deckelGruppe.add(deckelplatte);
            deckelGruppe.add(createEdges(deckelplatte)); // Kanten hinzufügen

            // Deckelplatte Leisten horizontal erstellen und zur Deckel-Baugruppe hinzufügen
            const abstandDeckelLeistenHorizontal = (breite + SteherHöhe * 2 + SeitenleisteHorizontalStärke * 2 - DeckelleisteHorizontalBreite) / (anzahlDeckelLeistenHorizontal - 1);
            const längeDeckelLeistenHorizontal = länge + 2 * KopfleisteVertikalStärke;
            const volumendeckelLeisteHorizontal = 2* anzahlDeckelLeistenHorizontal * längeDeckelLeistenHorizontal * DeckelleisteHorizontalStärke * DeckelleisteHorizontalBreite /1000;
            for (let i = 0; i < anzahlDeckelLeistenHorizontal; i++) {
                const deckelLeisteHorizontalGeometrie = new THREE.BoxGeometry(längeDeckelLeistenHorizontal, DeckelleisteHorizontalStärke, DeckelleisteHorizontalBreite);
                const deckelLeisteHorizontal = new THREE.Mesh(deckelLeisteHorizontalGeometrie, leistenDeckelHorizontalMaterial);
                deckelLeisteHorizontal.position.set(0, DeckelholzHöhe + DeckelleisteHorizontalStärke / 2, -breite / 2 - SteherHöhe - SeitenleisteHorizontalStärke + DeckelleisteHorizontalBreite/2 + i * abstandDeckelLeistenHorizontal);
                deckelGruppe.add(deckelLeisteHorizontal);
                deckelGruppe.add(createEdges(deckelLeisteHorizontal)); // Kanten hinzufügen
            }

            // Deckelplatte Leisten vertikal erstellen und zur Deckel-Baugruppe hinzufügen
            const abstandDeckelLeistenVertikal = (länge + 2* KopfleisteHorizontalStärke - DeckelleisteVertikalBreite) / (anzahlDeckelLeistenVertikal - 1);
            const längeDeckelLeistenVertikal = breite + 2 * SteherHöhe + 2 * SeitenleisteHorizontalStärke -2 * DeckelleisteHorizontalBreite;
            const volumenDeckelLeisteVertikal = 2* anzahlDeckelLeistenVertikal * DeckelleisteVertikalBreite * DeckelleisteVertikalStärke * längeDeckelLeistenVertikal /1000;
            for (let i = 0; i < anzahlDeckelLeistenVertikal; i++) {
                const deckelLeisteVertikalGeometrie = new THREE.BoxGeometry(DeckelleisteVertikalBreite, DeckelleisteVertikalStärke, längeDeckelLeistenVertikal);
                const deckelLeisteVertikal = new THREE.Mesh(deckelLeisteVertikalGeometrie, leistenDeckelVertikalMaterial);
                deckelLeisteVertikal.position.set(-länge / 2 - KopfleisteVertikalStärke + DeckelleisteVertikalBreite/2 + i * abstandDeckelLeistenVertikal, DeckelholzHöhe + DeckelleisteHorizontalStärke / 2, 0);
                deckelGruppe.add(deckelLeisteVertikal);
                deckelGruppe.add(createEdges(deckelLeisteVertikal)); // Kanten hinzufügen
            }

            // Deckelholz erstellen und zur Deckel-Baugruppe hinzufügen
            let abstandDeckelholz = länge / (anzahlDeckelholz + 1);
            const längeDeckelholz = breite + 2 * SteherHöhe + 2 * SeitenleisteVertikalStärke;
            const volumenDeckelholz = anzahlDeckelholz * DeckelholzBreite * DeckelholzHöhe * längeDeckelholz /1000;
            for (let i = 0; i < anzahlDeckelholz; i++) {
                const deckelholzGeometrie = new THREE.BoxGeometry(DeckelholzBreite, DeckelholzHöhe, längeDeckelholz);
                const deckelDeckelholz = new THREE.Mesh(deckelholzGeometrie, DeckelholzMaterial);
                deckelDeckelholz.position.set(-länge / 2 + abstandDeckelholz + i * abstandDeckelholz,DeckelholzHöhe / 2, 0);
                deckelGruppe.add(deckelDeckelholz);
                deckelGruppe.add(createEdges(deckelDeckelholz)); // Kanten hinzufügen
            }

            // Deckel-Baugruppe zur Kistengruppe hinzufügen
            deckelGruppe.position.set(0, höhe, 0);
            kistengruppe.add(deckelGruppe);

            const außenlänge = länge + 2* KopfleisteHorizontalStärke + 2 * sperrholzDicke;
            const außenbreite = breite + 2 * SteherHöhe + 2 * SeitenleisteHorizontalStärke + 2 * sperrholzDicke;
            const außenhöhe = (höhe + bodenBrettDicke + längskufenHöhe + querkufenHöhe +DeckelholzHöhe + DeckelleisteHorizontalStärke+ sperrholzDicke);
            const außenquadratmeter = 1/10000*(außenhöhe * außenlänge * 2 + außenhöhe * außenbreite * 2 +außenlänge* außenbreite * 2);
            const bodenquadratmeter = 1/10000*(außenlänge* außenbreite);
            const volumengesamt = 1/1000*(volumenBodenBretter+volumenDeckel+volumenDeckelLeisteVertikal+volumenDeckelholz+volumenKopfholz+volumenKopfleisteHorizontal+volumenKopfleisteVertikal+volumenKopfplatte+volumenLängskufen+volumenQuerkufen+volumenSeitenLeistenHorizontal+volumenSeitenplatte+volumenSteher+volumendeckelLeisteHorizontal+volumenseitenLeisteVertikal);
            const kgTara = volumengesamt*0.46*1000;
            const co2 = außenquadratmeter * 7.47 // Kiste	 Stahlnagel	 HT	 ohne Konservierung	 Sperrholz	 7.47 kg/m²
            

            //Statik
            const zulässigeSpannungHolz=240
            //Deckelholz
            const wiederstandsmomentDeckelholz = DeckelholzBreite * DeckelholzHöhe * DeckelholzHöhe/6;
            const streckenlastproDecelholz = stapellast*10/anzahlDeckelholz/längeDeckelholz;
            const maximalmomentDeckelholz = streckenlastproDecelholz * längeDeckelholz * längeDeckelholz/8;
            const erforderlichesWiederstandsmomentDeckelholz =  maximalmomentDeckelholz/zulässigeSpannungHolz;
            const sicherheitDeckelholz = wiederstandsmomentDeckelholz/erforderlichesWiederstandsmomentDeckelholz*100;




            //Kalkulation

            const stdSatzPlattensäge = parseFloat(document.getElementById('stdSatzPlattensäge').value);
            const stdSatzLeistenzuschnitt = parseFloat(document.getElementById('stdSatzLeistenzuschnitt').value);
            const stdSatzMitarbeiter = parseFloat(document.getElementById('stdSatzMitarbeiter').value);


            const anzahlPlatten = 5;
            const dauerPlattenzuschnittProPlatte = parseFloat(document.getElementById('dauerPlattenzuschnittProPlatte').value);
            const dauerPlattenzuschnitt = dauerPlattenzuschnittProPlatte * anzahlPlatten;
            const kostenPlattenzuschnitt = dauerPlattenzuschnitt * stdSatzPlattensäge/(60*60);

            const anzahlleisten = anzahlBodenBretter+anzahlKopfLeistenHorizontal*2+anzahlKopfLeistenVertikal*2+anzahlSeitenLeistenHorizontal*2+anzahlSeitenLeistenVertikal*2+anzahlDeckelLeistenHorizontal*2+anzahlDeckelLeistenVertikal*2+anzahlLängskufen+anzahlQuerkufen+anzahlSteher*2+anzahlDeckelholz*2+anzahlKopfholz;
            const dauerLeistenschnittProLeiste = parseFloat(document.getElementById('dauerLeistenschnittProLeiste').value);
            const dauerLeistenzuschnitt = dauerLeistenschnittProLeiste * anzahlleisten;
            const kostenLeistenzuschnitt = dauerLeistenzuschnitt * stdSatzLeistenzuschnitt/(60*60);

            const anzahlBodenhölzer= anzahlLängskufen+anzahlQuerkufen+anzahlKopfholz;
            const dauerBodenhölzerAuflegenProHolz = parseFloat(document.getElementById('dauerBodenhölzerAuflegenProHolz').value);
            const dauerBodenhölzerAuflegen = dauerBodenhölzerAuflegenProHolz * anzahlBodenhölzer;
            const kostenBodenhölzerAuflegen = dauerBodenhölzerAuflegen * stdSatzMitarbeiter/(60*60);

            const anzahlBodenhölzerVerbindungen = anzahlLängskufen * anzahlQuerkufen + anzahlLängskufen * anzahlKopfholz ;
            const dauerBodenhölzerVerbindungenVerbolzenProHolz = parseFloat(document.getElementById('dauerBodenhölzerVerbindungenVerbolzenProHolz').value);
            const dauerBodenhölzerVerbindungenVerbolzen = dauerBodenhölzerVerbindungenVerbolzenProHolz * anzahlBodenhölzerVerbindungen;
            const kostenBodenhölzerVerbindungenVerbolzen = dauerBodenhölzerVerbindungenVerbolzen * stdSatzMitarbeiter/(60*60);

            const anzahlBodenBretterFürKalk = anzahlBodenBretter;
            const dauerBodenbretterAuflegenUndVernagelnProHolz = parseFloat(document.getElementById('dauerBodenbretterAuflegenUndVernagelnProHolz').value);
            const dauerBodenbretterAuflegenUndVernageln = dauerBodenbretterAuflegenUndVernagelnProHolz * anzahlBodenBretterFürKalk;
            const kostenBodenbretterAuflegenUndVernageln = dauerBodenhölzerVerbindungenVerbolzen * stdSatzMitarbeiter/(60*60);

            const Fertigungseinzelkosten = kostenPlattenzuschnitt +kostenLeistenzuschnitt + kostenBodenhölzerAuflegen + kostenBodenhölzerVerbindungenVerbolzen + kostenBodenbretterAuflegenUndVernageln;
            const zuschlagssatzFertigungsgemeinkosten = parseFloat(document.getElementById('zuschlagssatzFertigungsgemeinkosten').value);
            const Fertigungsgemeinkosten = zuschlagssatzFertigungsgemeinkosten/100 * Fertigungseinzelkosten;
            const Fertigungskosten = Fertigungseinzelkosten + Fertigungsgemeinkosten;
            const marteialeinzelkosten = volumengesamt * 200;
            const zuschlagssatzMaterialgemeinkosten = parseFloat(document.getElementById('zuschlagssatzMaterialgemeinkosten').value);
            const Materialgeminkosten = zuschlagssatzMaterialgemeinkosten/100 * marteialeinzelkosten;
            const Materialkosten = Materialgeminkosten + marteialeinzelkosten;
            const herstellkosten = Fertigungskosten + Materialkosten;
            
            


            const kommastellen=1;

            //Output für Textfelder
            document.getElementById('längeLängskufen').textContent=längeLängskufen
            document.getElementById('volumenLängskufen').textContent=volumenLängskufen.toFixed(kommastellen)
            document.getElementById('längeQuerkufen').textContent=längeQuerkufen
            document.getElementById('volumenQuerkufen').textContent=volumenQuerkufen.toFixed(kommastellen)
            document.getElementById('anzahlKopfholz').textContent=anzahlKopfholz
            document.getElementById('längeKopfholz').textContent=längeKopfholz
            document.getElementById('volumenKopfholz').textContent=volumenKopfholz.toFixed(kommastellen)
            document.getElementById('anzahlBodenBretter').textContent=anzahlBodenBretter
            document.getElementById('bodenBrettLänge').textContent=bodenBrettLänge
            document.getElementById('volumenBodenBretter').textContent=volumenBodenBretter.toFixed(kommastellen)
            document.getElementById('längeSeitenLeistenHorizontal').textContent=längeSeitenLeistenHorizontal
            document.getElementById('volumenSeitenLeistenHorizontal').textContent=volumenSeitenLeistenHorizontal.toFixed(kommastellen)
            document.getElementById('längeSeitenLeistenVertikal').textContent=längeSeitenLeistenVertikal
            document.getElementById('volumenseitenLeisteVertikal').textContent=volumenseitenLeisteVertikal.toFixed(kommastellen)
            document.getElementById('längeKopfLeistenHorizontal').textContent=längeKopfLeistenHorizontal
            document.getElementById('volumenKopfleisteHorizontal').textContent=volumenKopfleisteHorizontal.toFixed(kommastellen)
            document.getElementById('längeKopfLeistenVertikal').textContent=längeKopfLeistenVertikal
            document.getElementById('volumenKopfleisteVertikal').textContent=volumenKopfleisteVertikal.toFixed(kommastellen)
            document.getElementById('längeDeckelLeistenHorizontal').textContent=längeDeckelLeistenHorizontal
            document.getElementById('volumendeckelLeisteHorizontal').textContent=volumendeckelLeisteHorizontal.toFixed(kommastellen)          
            document.getElementById('längeDeckelLeistenVertikal').textContent=längeDeckelLeistenVertikal
            document.getElementById('volumenDeckelLeisteVertikal').textContent=volumenDeckelLeisteVertikal.toFixed(kommastellen)
            document.getElementById('längeSteher').textContent=längeSteher
            document.getElementById('volumenSteher').textContent=volumenSteher.toFixed(kommastellen)
            document.getElementById('längeDeckelholz').textContent=längeDeckelholz
            document.getElementById('volumenDeckelholz').textContent=volumenDeckelholz.toFixed(kommastellen)
            document.getElementById('sicherheitDeckelholz').textContent=sicherheitDeckelholz.toFixed(0)
            document.getElementById('innenlänge').textContent=länge.toFixed(0)
            document.getElementById('innenbreite').textContent=breite.toFixed(0)
            document.getElementById('innenhöhe').textContent=höhe.toFixed(0)
            document.getElementById('außenlänge').textContent=außenlänge.toFixed(0)
            document.getElementById('außenbreite').textContent=außenbreite.toFixed(0)
            document.getElementById('außenhöhe').textContent=außenhöhe.toFixed(0)
            document.getElementById('außenquadratmeter').textContent=außenquadratmeter.toFixed(1)
            document.getElementById('bodenquadratmeter').textContent=bodenquadratmeter.toFixed(1)
            document.getElementById('volumengesamt').textContent=volumengesamt.toFixed(2)
            document.getElementById('kgTara').textContent=kgTara.toFixed(0)
            document.getElementById('co2').textContent=co2.toFixed(2)

            document.getElementById('anzahlPlatten').textContent=anzahlPlatten.toFixed(0)
            document.getElementById('dauerPlattenzuschnitt').textContent=(dauerPlattenzuschnitt/60).toFixed(1)
            document.getElementById('kostenPlattenzuschnitt').textContent=kostenPlattenzuschnitt.toFixed(2)

            document.getElementById('anzahlleisten').textContent=anzahlleisten.toFixed(0) 
            document.getElementById('dauerLeistenzuschnitt').textContent=(dauerLeistenzuschnitt/60).toFixed(1) 
            document.getElementById('kostenLeistenzuschnitt').textContent=kostenLeistenzuschnitt.toFixed(2) 

            document.getElementById('anzahlBodenhölzer').textContent=anzahlBodenhölzer.toFixed(0) 
            document.getElementById('dauerBodenhölzerAuflegen').textContent=(dauerBodenhölzerAuflegen/60).toFixed(1) 
            document.getElementById('kostenBodenhölzerAuflegen').textContent=kostenBodenhölzerAuflegen.toFixed(2) 

            document.getElementById('anzahlBodenhölzerVerbindungen').textContent=anzahlBodenhölzerVerbindungen.toFixed(0) 
            document.getElementById('dauerBodenhölzerVerbindungenVerbolzen').textContent=(dauerBodenhölzerVerbindungenVerbolzen/60).toFixed(1) 
            document.getElementById('kostenBodenhölzerVerbindungenVerbolzen').textContent=kostenBodenhölzerVerbindungenVerbolzen.toFixed(2) 

            document.getElementById('anzahlBodenBretterFürKalk').textContent=anzahlBodenBretterFürKalk.toFixed(0) 
            document.getElementById('dauerBodenbretterAuflegenUndVernageln').textContent=(dauerBodenbretterAuflegenUndVernageln/60).toFixed(1) 
            document.getElementById('kostenBodenbretterAuflegenUndVernageln').textContent=kostenBodenbretterAuflegenUndVernageln.toFixed(2) 

            document.getElementById('Fertigungseinzelkosten').textContent=Fertigungseinzelkosten.toFixed(2) 
            document.getElementById('Fertigungsgemeinkosten').textContent=Fertigungsgemeinkosten.toFixed(2)
            document.getElementById('Fertigungskosten').textContent=Fertigungskosten.toFixed(2)
            document.getElementById('marteialeinzelkosten').textContent=marteialeinzelkosten.toFixed(2)
            document.getElementById('Materialgeminkosten').textContent=Materialgeminkosten.toFixed(2)
            document.getElementById('Materialkosten').textContent=Materialkosten.toFixed(2)
            document.getElementById('herstellkosten').textContent=herstellkosten.toFixed(2)




        }

        // Event-Listener für den AR
        document.getElementById('startARButton').addEventListener('click', startAR);

        // Event-Listener für den Umschalt-Button
        document.getElementById('toggleCameraButton').addEventListener('click', toggleCameraView);

        // Event-Listener für den Upload-Button
        document.getElementById('customButton').addEventListener('click', function() {
            document.getElementById('uploadButton').click();
        });
        document.getElementById('uploadButton').addEventListener('change', uploadJSON);

        // Event-Listener für den Export-Button
        document.getElementById('exportButton').addEventListener('click', exportDataAsPDF);

        // Event-Listener für den Export-Button
        document.getElementById('saveButton').addEventListener('click', exportParameters);

        // Event-Listener für den Speichern-Button
        document.querySelector('.saveDataToDatabase').addEventListener('click', saveDataToDatabase);

        // JavaScript for handling the close and open actions
        document.querySelector('.open-kalkulation-button').addEventListener('click', function() {
            document.querySelector('.controls2').style.display = 'block';
        });

        document.querySelector('.close-button').addEventListener('click', function() {
            document.querySelector('.controls2').style.display = 'none';
        });


        // Event-Listener für die Schieberegler und Eingabefelder
        document.getElementById('länge').addEventListener('input', aktualisiereKiste);
        document.getElementById('breite').addEventListener('input', aktualisiereKiste);
        document.getElementById('höhe').addEventListener('input', aktualisiereKiste);

        document.getElementById('nettogewicht').addEventListener('input', aktualisiereKiste);
        document.getElementById('stapellast').addEventListener('input', aktualisiereKiste);


        document.getElementById('anzahlLängskufen').addEventListener('input', aktualisiereKiste);
        document.getElementById('anzahlQuerkufen').addEventListener('input', aktualisiereKiste);

        document.getElementById('längskufenBreite').addEventListener('input', aktualisiereKiste);
        document.getElementById('längskufenHöhe').addEventListener('input', aktualisiereKiste);

        document.getElementById('kopfholzBreite').addEventListener('input', aktualisiereKiste);
        document.getElementById('kopfholzHöhe').addEventListener('input', aktualisiereKiste);

        document.getElementById('bodenBrettDicke').addEventListener('input', aktualisiereKiste);
        document.getElementById('bodenBrettBreite').addEventListener('input', aktualisiereKiste);

        document.getElementById('querkufenBreite').addEventListener('input', aktualisiereKiste);
        document.getElementById('querkufenHöhe').addEventListener('input', aktualisiereKiste);
        //document.getElementById('sperrholzDicke').addEventListener('input', aktualisiereKiste);

        document.getElementById('KopfleisteHorizontalStärke').addEventListener('input', function() {const value = this.value; document.getElementById('KopfleisteVertikalStärke').value = value; aktualisiereKiste();});
        document.getElementById('KopfleisteHorizontalBreite').addEventListener('input', aktualisiereKiste);
        document.getElementById('anzahlKopfLeistenHorizontal').addEventListener('input', aktualisiereKiste);     

        document.getElementById('KopfleisteVertikalStärke').addEventListener('input', function() {const value = this.value; document.getElementById('KopfleisteHorizontalStärke').value = value;aktualisiereKiste();});
        document.getElementById('KopfleisteVertikalBreite').addEventListener('input', aktualisiereKiste);
        document.getElementById('anzahlKopfLeistenVertikal').addEventListener('input', aktualisiereKiste);

        document.getElementById('SeitenleisteHorizontalStärke').addEventListener('input', function() {const value = this.value; document.getElementById('SeitenleisteVertikalStärke').value = value; aktualisiereKiste();});
        document.getElementById('SeitenleisteHorizontalBreite').addEventListener('input', aktualisiereKiste);
        document.getElementById('anzahlSeitenLeistenHorizontal').addEventListener('input', aktualisiereKiste);

        document.getElementById('SeitenleisteVertikalStärke').addEventListener('input', function() {const value = this.value; document.getElementById('SeitenleisteHorizontalStärke').value = value; aktualisiereKiste(); });
        document.getElementById('SeitenleisteVertikalBreite').addEventListener('input', aktualisiereKiste);
        document.getElementById('anzahlSeitenLeistenVertikal').addEventListener('input', aktualisiereKiste);

        document.getElementById('DeckelleisteHorizontalStärke').addEventListener('input', function() {const value = this.value; document.getElementById('DeckelleisteVertikalStärke').value = value; aktualisiereKiste(); });
        document.getElementById('DeckelleisteHorizontalBreite').addEventListener('input', aktualisiereKiste);
        document.getElementById('anzahlDeckelLeistenHorizontal').addEventListener('input', aktualisiereKiste);

        document.getElementById('DeckelleisteVertikalStärke').addEventListener('input', function() { const value = this.value; document.getElementById('DeckelleisteHorizontalStärke').value = value; aktualisiereKiste();});
        document.getElementById('DeckelleisteVertikalBreite').addEventListener('input', aktualisiereKiste);
        document.getElementById('anzahlDeckelLeistenVertikal').addEventListener('input', aktualisiereKiste); 

        document.getElementById('SteherHöhe').addEventListener('input', aktualisiereKiste); 
        document.getElementById('SteherBreite').addEventListener('input', aktualisiereKiste);
        document.getElementById('anzahlSteher').addEventListener('input', aktualisiereKiste);
        document.getElementById('DeckelholzHöhe').addEventListener('input', aktualisiereKiste);
        document.getElementById('DeckelholzBreite').addEventListener('input', aktualisiereKiste);
        document.getElementById('anzahlDeckelholz').addEventListener('input', aktualisiereKiste);


        document.getElementById('stdSatzPlattensäge').addEventListener('input', aktualisiereKiste); 
        document.getElementById('stdSatzLeistenzuschnitt').addEventListener('input', aktualisiereKiste); 
        document.getElementById('stdSatzMitarbeiter').addEventListener('input', aktualisiereKiste); 
        document.getElementById('dauerPlattenzuschnittProPlatte').addEventListener('input', aktualisiereKiste); 
        document.getElementById('dauerLeistenschnittProLeiste').addEventListener('input', aktualisiereKiste);  
        document.getElementById('dauerBodenhölzerAuflegenProHolz').addEventListener('input', aktualisiereKiste); 
        document.getElementById('dauerBodenhölzerVerbindungenVerbolzenProHolz').addEventListener('input', aktualisiereKiste);  
        document.getElementById('dauerBodenbretterAuflegenUndVernagelnProHolz').addEventListener('input', aktualisiereKiste); 
        document.getElementById('zuschlagssatzFertigungsgemeinkosten').addEventListener('input', aktualisiereKiste);
        document.getElementById('zuschlagssatzMaterialgemeinkosten').addEventListener('input', aktualisiereKiste); 



        function aktualisiereKiste() {

            // Entferne alte Kiste
            while (kistengruppe.children.length > 0) {
                kistengruppe.remove(kistengruppe.children[0]);
            }

            // Erstelle neue Kiste
            erstelleKiste();

                // Sicherheitswert prüfen und Hintergrundfarbe ändern
                const sicherheitDeckelholzElement = document.getElementById('sicherheitDeckelholz');
                const sicherheitDeckelholzWert = parseFloat(sicherheitDeckelholzElement.textContent);

                if (sicherheitDeckelholzWert > 100) {
                    sicherheitDeckelholzElement.style.backgroundColor = 'green';
                    sicherheitDeckelholzElement.style.color = 'white'; // Textfarbe anpassen
                } else {
                    sicherheitDeckelholzElement.style.backgroundColor = 'red';
                    sicherheitDeckelholzElement.style.color = 'white'; // Textfarbe anpassen
                }
            
        }

        // Initiale Kiste erstellen
        erstelleKiste();

        // Kamera Positionieren
        kameraPerspektiv.position.set(0, 100, 300);
        kameraOrthogonal.position.set(0, 100, 300);
        kameraPerspektiv.lookAt(0, 0, 0);
        kameraOrthogonal.lookAt(0, 0, 0);


        // Animationsschleife
        function animate() {
            requestAnimationFrame(animate);
            steuerung.update(); // nur notwendig, wenn enableDamping aktiviert ist
            renderer.render(szene, aktuelleKamera);
        }
        animate();

        // Fenstergröße anpassen
        window.addEventListener('resize', () => {
            kameraPerspektiv.aspect = window.innerWidth / window.innerHeight;
            kameraPerspektiv.updateProjectionMatrix();
            kameraOrthogonal.left = window.innerWidth / -2;
            kameraOrthogonal.right = window.innerWidth / 2;
            kameraOrthogonal.top = window.innerHeight / 2;
            kameraOrthogonal.bottom = window.innerHeight / -2;
            kameraOrthogonal.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Initiale Kiste erstellen
        aktualisiereKiste();

        function exportDataAsPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            const data = [
                ['Komponente', 'Höhe', 'Stärke', 'Anzahl', 'Länge', 'dm³'],
                ['LK', document.getElementById('längskufenHöhe').value, document.getElementById('längskufenBreite').value, document.getElementById('anzahlLängskufen').value, document.getElementById('längeLängskufen').textContent, document.getElementById('volumenLängskufen').textContent],
                ['QK', document.getElementById('querkufenHöhe').value, document.getElementById('querkufenBreite').value, document.getElementById('anzahlQuerkufen').value, document.getElementById('längeQuerkufen').textContent, document.getElementById('volumenQuerkufen').textContent],
                ['Kopfhölzer', document.getElementById('kopfholzHöhe').value, document.getElementById('kopfholzBreite').value, document.getElementById('anzahlKopfholz').textContent, document.getElementById('längeKopfholz').textContent, document.getElementById('volumenKopfholz').textContent],
                ['Bodenauflage', document.getElementById('bodenBrettDicke').value, document.getElementById('bodenBrettBreite').value, document.getElementById('anzahlBodenBretter').textContent, document.getElementById('bodenBrettLänge').textContent, document.getElementById('volumenBodenBretter').textContent],
                ['SL vertikal', document.getElementById('SeitenleisteVertikalBreite').value, document.getElementById('SeitenleisteVertikalStärke').value, document.getElementById('anzahlSeitenLeistenVertikal').value, document.getElementById('längeSeitenLeistenVertikal').textContent, document.getElementById('volumenseitenLeisteVertikal').textContent],
                ['SL horizontal', document.getElementById('SeitenleisteHorizontalBreite').value, document.getElementById('SeitenleisteHorizontalStärke').value, document.getElementById('anzahlSeitenLeistenHorizontal').value, document.getElementById('längeSeitenLeistenHorizontal').textContent, document.getElementById('volumenSeitenLeistenHorizontal').textContent],
                ['KL vertikal', document.getElementById('KopfleisteVertikalBreite').value, document.getElementById('KopfleisteVertikalStärke').value, document.getElementById('anzahlKopfLeistenVertikal').value, document.getElementById('längeKopfLeistenVertikal').textContent, document.getElementById('volumenKopfleisteVertikal').textContent],
                ['KL horizontal', document.getElementById('KopfleisteHorizontalBreite').value, document.getElementById('KopfleisteHorizontalStärke').value, document.getElementById('anzahlKopfLeistenHorizontal').value, document.getElementById('längeKopfLeistenHorizontal').textContent, document.getElementById('volumenKopfleisteHorizontal').textContent],
                ['DL vertikal', document.getElementById('DeckelleisteVertikalBreite').value, document.getElementById('DeckelleisteVertikalStärke').value, document.getElementById('anzahlDeckelLeistenVertikal').value, document.getElementById('längeDeckelLeistenVertikal').textContent, document.getElementById('volumenDeckelLeisteVertikal').textContent],
                ['DL horizontal', document.getElementById('DeckelleisteHorizontalBreite').value, document.getElementById('DeckelleisteHorizontalStärke').value, document.getElementById('anzahlDeckelLeistenHorizontal').value, document.getElementById('längeDeckelLeistenHorizontal').textContent, document.getElementById('volumendeckelLeisteHorizontal').textContent],
                ['Deckelhölzer', document.getElementById('DeckelholzHöhe').value, document.getElementById('DeckelholzBreite').value, document.getElementById('anzahlDeckelholz').value, document.getElementById('längeDeckelholz').textContent, document.getElementById('volumenDeckelholz').textContent],
                ['Steher', document.getElementById('SteherHöhe').value, document.getElementById('SteherBreite').value, document.getElementById('anzahlSteher').value, document.getElementById('längeSteher').textContent, document.getElementById('volumenSteher').textContent]
            ];

            doc.text("Kistenzettel", 10, 10);
            doc.autoTable({
                head: [data[0]],
                body: data.slice(1),
            });

            doc.text(`Innenmaße L x B x H: ${document.getElementById('innenlänge').textContent} x ${document.getElementById('innenbreite').textContent} x ${document.getElementById('innenhöhe').textContent}`, 10, doc.lastAutoTable.finalY + 10);
            doc.text(`Außenmaße L x B x H: ${document.getElementById('außenlänge').textContent} x ${document.getElementById('außenbreite').textContent} x ${document.getElementById('außenhöhe').textContent}`, 10, doc.lastAutoTable.finalY + 20);
            doc.text(`AQM: ${document.getElementById('außenquadratmeter').textContent} m²`, 10, doc.lastAutoTable.finalY + 30);
            doc.text(`BQM: ${document.getElementById('bodenquadratmeter').textContent} m²`, 10, doc.lastAutoTable.finalY + 40);
            doc.text(`m³: ${document.getElementById('volumengesamt').textContent} m³`, 10, doc.lastAutoTable.finalY + 50);
            doc.text(`kg Tara: ${document.getElementById('kgTara').textContent} kg`, 10, doc.lastAutoTable.finalY + 60);
            doc.text(`CO2: ${document.getElementById('co2').textContent} kg`, 10, doc.lastAutoTable.finalY + 70);
            doc.text(`marteialeinzelkosten: ${document.getElementById('marteialeinzelkosten').textContent} €`, 10, doc.lastAutoTable.finalY + 80);

            doc.save('exported_data.pdf');
        }

        function saveDataToDatabase() {
            const data = {
                länge: document.getElementById('länge').value,
                breite: document.getElementById('breite').value,
                höhe: document.getElementById('höhe').value,
                nettogewicht: document.getElementById('nettogewicht').value,
                stapellast: document.getElementById('stapellast').value,
                anzahlLängskufen: document.getElementById('anzahlLängskufen').value,
                anzahlQuerkufen: document.getElementById('anzahlQuerkufen').value,
                längskufenBreite: document.getElementById('längskufenBreite').value,
                längskufenHöhe: document.getElementById('längskufenHöhe').value,
                kopfholzBreite: document.getElementById('kopfholzBreite').value,
                kopfholzHöhe: document.getElementById('kopfholzHöhe').value,
                bodenBrettDicke: document.getElementById('bodenBrettDicke').value,
                bodenBrettBreite: document.getElementById('bodenBrettBreite').value,
                querkufenBreite: document.getElementById('querkufenBreite').value,
                querkufenHöhe: document.getElementById('querkufenHöhe').value
            };

            fetch('/api/data', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                console.log('Daten erfolgreich in die Datenbank geschrieben:', result);
            })
            .catch(error => {
                console.error('Fehler beim Schreiben der Daten in die Datenbank:', error);
            });
        }










        
    </script>
</body>
</html>
